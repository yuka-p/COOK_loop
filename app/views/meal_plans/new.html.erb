<% content_for :title, "献立作成" %>
<div data-controller="meal-plans-new" class="max-w-3xl mx-auto mt-8 space-y-6">

  <!-- フィルターエリア -->
  <div class="card bg-base-100 shadow px-8 py-4 max-w-2xl mx-auto
            page-section page-delay-1">
    <!-- 中央寄せ用ラッパー -->
    <div class="max-w-4xl mx-auto space-y-4">
      <!-- 1段目：ジャンル + 並び替え -->
      <div class="flex flex-col md:flex-row md:items-center gap-4">

        <!-- 左：ジャンル -->
        <div class="flex-1">
          <div id="genreFilters" class="flex gap-2 flex-wrap">
            <button
              class="btn btn-sm genre-filter-button
                     bg-[#bebbf7]/40
                     text-gray-700
                     border border-[#bebbf7]
                     hover:bg-[#bebbf7]/60"
              data-genre="all"
              type="button">
              すべて
            </button>
            <% MyMenu.genres.keys.each do |genre| %>
              <button
                class="btn btn-sm genre-filter-button <%= genre_button_class(genre) %>"
                data-genre="<%= genre %>"
                type="button">
                <%= MyMenu.genres_i18n[genre] %>
                <span
                  id="count-<%= genre %>"
                  class="ml-1 hidden text-xs font-bold bg-primary text-white rounded-full px-1.5">
                </span>
              </button>
            <% end %>
          </div>
        </div>

        <!-- 右：並び替え -->
        <div class="w-full md:w-56">
          <select id="sortSelect" class="select select-bordered w-full">
            <option value="last_cooked_desc">最近作っていない順</option>
            <option value="created_desc">新しい順</option>
            <option value="title_asc">50音順</option>
          </select>
        </div>
      </div>

      <!-- 2段目：タグ -->
      <% if @tags.present? %>
          <div id="tagFilters" class="flex gap-2 flex-wrap">
            <% @tags.each do |tag| %>
              <button
                type="button"
                class="tag-filter-button"
                data-tag-id="<%= tag.id %>">
                <%= tag.name %>
              </button>
            <% end %>
          </div>
      <% end %>
    </div>
  </div>
  <%= form_with url: confirm_meal_plans_path, method: :post, data: { turbo_frame: "modal" } do %>

    <!-- メニュー一覧 -->
    <div class="bg-[#faf0e6] p-4 sm:p-8 rounded-2xl my-6 space-y-4 sm:space-y-6
            page-section page-delay-2">
      <div id="menuList" class="grid grid-cols-1 sm:grid-cols-2 gap-4 page-section page-delay-3">

        <% @my_menus.each do |menu| %>
          <label
            class="menu-item relative block max-w-xs w-full mx-auto cursor-pointer"
            data-genre="<%= menu.genre %>"
            data-tags="<%= menu.tags.pluck(:id).join(',') %>">
    
            <!-- チェックボックス -->
            <%= check_box_tag "my_menu_ids[]", menu.id, false,
                  class: "peer hidden menu-checkbox" %>

            <!-- メニューカード -->
            <div class="p-4 rounded-xl border border-base-300 bg-white shadow-sm
                        hover:shadow-md transition
                        peer-checked:bg-[#f6a56c]/20
                        peer-checked:border-[#f6a56c]
                        peer-checked:shadow-md">
              <span class="text-sm sm:text-base font-medium peer-checked:text-[#f6a56c]">
                <%= menu.title %>
              </span>
            </div>

            <!-- 選択チェックマーク -->
            <span class="absolute top-2 right-2 text-[#f6a56c] text-lg
                         opacity-0 scale-75 transition
                         peer-checked:opacity-100 peer-checked:scale-100">
              ✓
            </span>
          </label>
        <% end %>

      </div>
    </div>


  <div class="pt-6 flex justify-center gap-4
            page-section page-delay-4">
    <%= submit_tag "決定",
        class: "action-primary" %>

    <%= link_to home_path, class: "nav-back-button" do %>
      ← ホーム
    <% end %>

  </div>
  <% end %>

  <%= turbo_frame_tag "modal", class: "page-section page-delay-4" %>
</div>
