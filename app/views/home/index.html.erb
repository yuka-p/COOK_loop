<div class="max-w-md mx-auto mt-6 px-3 sm:px-0">

  <% if @my_menus.blank? %>

  <!-- マイメニューがない場合 -->
  <div class="text-center mt-10 space-y-4">
    <p class="text-sm text-base-content/70">
      まずは下の『マイメニュー』ボタンより、
      よく作る料理を登録してみましょう 🍳
    </p>
  </div>

<% elsif @meal_items.blank? %>

  <!-- 献立がない場合 -->
  <div class="text-center mt-10 space-y-4">
    <p class="text-sm text-base-content/70">
      今日はどんな献立にしますか？ 📅
    </p>
  </div>

<% else %>

  <!-- トグルボタン -->
    <div class="flex justify-between mb-6 max-w-md mx-auto">
      <button type="button" id="toggle-meal-plan"
              class="btn btn-sm btn-outline">
      献立を非表示
      </button>
    </div>

    <div id="meal-plan-area" class="w-full">
      <%= form_with url: bulk_update_meal_items_path, method: :patch, local: true do %>
      <div class="card bg-base-100 shadow-md rounded-2xl">
        <div class="card-body px-3 py-4 sm:px-5 sm:py-6">

          <% @meal_items
               .sort_by { |genre, _| MyMenu.genres[genre] }
               .each do |genre, items| %>

            <% next if items.blank? %>
            <div class="mb-8">

                <!-- ジャンル見出し -->
              <h3 class="text-sm font-semibold mb-3
                        border-l-4
                        px-4 py-1.5 rounded-md tracking-wide
                        <%= genre_heading_class(genre) %>">
                <%= MyMenu.genres_i18n[genre] %>
              </h3>

              <!-- 献立リスト -->
                <ul class="space-y-1">
                  <% items.each do |meal_item| %>
                    <li class="flex items-center gap-3 px-3 py-2 rounded-lg
                               hover:bg-base-200 transition">
                      <%= check_box_tag "meal_item_ids[]",
                                        meal_item.id,
                                        false,
                                        class: "checkbox" %>

                      <div class="flex-1 text-sm">
                        <p class="font-medium">
                          <%= meal_item.my_menu.title %>
                        </p>
                      </div>
                    </li>
                  <% end %>
                </ul>
              </div>
            <% end %>

          <!-- ボタン -->
            <div class="flex justify-end gap-3 mt-6">
              <%= button_tag "作成完了",
                type: :submit,
                name: "commit_action",
                value: "mark_as_cooked",
                class: "action-primary"
              %>

              <%= button_tag "リストから削除",
                    type: :submit,
                    name: "commit_action",
                    value: "remove_from_plan",
                    class: "btn btn-outline btn-error" %>
            </div>

        </div>
      </div>
      <% end %>
    </div>

  <% end %>

  <!-- ▼ おすすめメニュー -->
  <div class="max-w-md mx-auto mt-10">
    <div class="flex justify-between items-center mb-3">
      <h3 class="text-sm font-semibold">🍽 今日のおすすめ</h3>

      <%= link_to "更新",
            meal_plans_path,
            class: "btn btn-xs btn-outline" %>
    </div>

    <% if @recommended_menus.present? %>
  <div class="space-y-3">
    <% @recommended_menus.each do |menu| %>
      <div class="card bg-base-100 shadow-sm">
        <div class="card-body py-3 px-4 flex-row items-center justify-between">
          <span class="text-sm font-medium">
            <%= menu.title %>
          </span>

          <%= button_to "＋",
                add_meal_item_my_menu_path(menu),
                method: :post,
                class: "btn btn-sm btn-circle btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

  </div>

  <!-- ▼ メニューリンク -->
  <div class="flex justify-center gap-8 mt-10 relative">

    <%= link_to my_menus_path,
      class: "round-action-card w-40 h-40 sm:w-44 sm:h-44 flex flex-col items-center justify-center gap-2" do %>

      <%= image_tag "my_menu.png", class: "w-20 h-20 object-contain" %>

      <span class="text-sm font-semibold tracking-wide">
        マイメニュー
      </span>

    <% end %>


    <%= link_to new_meal_plan_path,
      class: "round-action-card w-40 h-40 sm:w-44 sm:h-44 flex flex-col items-center justify-center gap-2" do %>

      <%= image_tag "meal_plan.png", class: "w-20 h-20 object-contain" %>

      <span class="text-sm font-semibold tracking-wide">
        献立をつくる
      </span>

    <% end %>

  </div>
</div>
