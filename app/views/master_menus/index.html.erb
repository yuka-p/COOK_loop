<div class="max-w-2xl mx-auto mt-8">

  <%# --- 選択中 menu_ids を取得して配列化 --- %>
  <% selected_menu_ids = Array(params[:menu_ids]) %>

  <!-- ページタイトル -->
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-bold">マスターメニュー一覧</h1>

    <%= link_to home_index_path, class: "btn btn-outline" do %>
      ⬅ ホームに戻る
    <% end %>
  </div>

  <!-- ▼ジャンルフィルターボタン（元の仕様のまま） -->
  <div class="flex gap-3 mb-6">
    <%= link_to "全て",
                master_menus_path(menu_ids: selected_menu_ids),
                class: "btn #{params[:genre].blank? ? 'btn-primary' : 'btn-outline'}" %>

    <%= link_to "主菜",
                master_menus_path(genre: :main, menu_ids: selected_menu_ids),
                class: "btn #{params[:genre] == 'main' ? 'btn-primary' : 'btn-outline'}" %>

    <%= link_to "副菜",
                master_menus_path(genre: :side, menu_ids: selected_menu_ids),
                class: "btn #{params[:genre] == 'side' ? 'btn-primary' : 'btn-outline'}" %>

    <%= link_to "汁物",
                master_menus_path(genre: :soup, menu_ids: selected_menu_ids),
                class: "btn #{params[:genre] == 'soup' ? 'btn-primary' : 'btn-outline'}" %>

    <%= link_to "主食",
                master_menus_path(genre: :staple, menu_ids: selected_menu_ids),
                class: "btn #{params[:genre] == 'staple' ? 'btn-primary' : 'btn-outline'}" %>
  </div>

  <%= form_with url: import_from_master_my_menus_path,
              method: :post,
              data: { controller: "modal", turbo_frame: "_top" } do |f| %>

    <!-- 現在の選択を hidden で維持 -->
    <% selected_menu_ids.each do |id| %>
      <input type="hidden" name="menu_ids[]" value="<%= id %>">
    <% end %>

    <div class="grid grid-cols-3 gap-4">
      <% @master_menus.each do |menu| %>
        <div class="p-4 border rounded shadow">
          <label>
            <input
              type="checkbox"
              name="menu_ids[]"
              value="<%= menu.id %>"
              class="mr-2"
              <%= "checked" if selected_menu_ids.include?(menu.id.to_s) %>
            >
            <span class="font-semibold"><%= menu.title %></span>
          </label>
        </div>
      <% end %>
    </div>

    <div class="mt-4">
      <%= f.submit "登録内容を確認", class: "bg-blue-500 text-white px-4 py-2 rounded" %>
    </div>

  <% end %>
</div>

<%= turbo_frame_tag "modal" %>
