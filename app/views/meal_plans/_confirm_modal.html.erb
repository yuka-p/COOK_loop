<%= turbo_frame_tag "modal" do %>
  <div class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded shadow-lg w-96">

      <% grouped_menus =
           @selected_menus
             .group_by(&:genre)
             .sort_by { |genre, _| MyMenu.genres[genre] } %>

      <% grouped_menus.each do |genre, menus| %>
        <div class="mb-4">
          <h3 class="text-sm font-semibold mb-2
                     border-l-4
                     px-3 py-1 rounded
                     <%= genre_heading_class(genre) %>">
            <%= menus.first.genre_i18n %>
          </h3>
          <ul class="list-disc ml-6">
            <% menus.each do |menu| %>
              <li><%= menu.title %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="text-right mt-8 flex justify-end gap-2">
        <%= form_with model: @meal_plan,
              url: meal_plans_path,
              method: :post,
              data: { turbo_frame: "_top" } do |f| %>

          <% @selected_menus.each do |menu| %>
            <%= hidden_field_tag "meal_plan[my_menu_ids][]", menu.id %>
          <% end %>

          <%= f.submit "登録する",
                       class: "px-4 py-2 rounded text-white transition",
                       style: "background-color: #907abf;" %>
        <% end %>

        <button type="button"
                onclick="this.closest('.modal-overlay').remove()"
                class="bg-white border border-gray-300 px-4 py-2 rounded text-gray-700 hover:bg-gray-50 transition">
          キャンセル
        </button>
      </div>
    </div>
  </div>
<% end %>
