<div class="max-w-md mx-auto mt-6 px-3 sm:px-0 page-fade">

  <% if @my_menus.blank? %>

  <div class="text-center mt-10 space-y-4">
    <p class="text-sm text-base-content/70">
      まずは下の『マイメニュー』ボタンより、<br>
      よく作る料理を登録してみましょう 🍳
    </p>
  </div>

<% elsif @meal_items.blank? %>

  <div class="text-center mt-10 space-y-4">
    <p class="text-sm text-base-content/70">
      今日はどんな献立にしますか？ 📅
    </p>
  </div>

<% else %>

    <div class="flex justify-between mb-6 max-w-md mx-auto">
      <button type="button" id="toggle-meal-plan"
              class="btn btn-sm btn-outline ml-auto">
      献立を非表示
      </button>
    </div>

    <div id="meal-plan-area" class="w-full home-section home-delay-1">
      <%= form_with url: bulk_update_meal_items_path, method: :patch, local: true do %>
      <div class="card bg-base-100 shadow-md rounded-2xl home-child child-1">
        <div class="card-body px-3 py-4 sm:px-5 sm:py-6">

          <% @meal_items
               .sort_by { |genre, _| MyMenu.genres[genre] }
               .each do |genre, items| %>

            <% next if items.blank? %>
            <div class="mb-8">

              <h3 class="text-sm font-semibold mb-3
                        border-l-4
                        px-4 py-1.5 rounded-md tracking-wide
                        <%= genre_heading_class(genre) %>">
                <%= MyMenu.genres_i18n[genre] %>
              </h3>

                <ul class="space-y-1">
                  <% items.each do |meal_item| %>
                    <li class="flex items-center gap-3 px-3 py-2 rounded-lg
                               hover:bg-base-200 transition">
                      <%= check_box_tag "meal_item_ids[]",
                                        meal_item.id,
                                        false,
                                        class: "checkbox check-pop" %>

                      <div class="flex-1 text-sm">
                        <p class="text-base">
                          <%= meal_item.my_menu.title %>
                        </p>
                      </div>
                    </li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <div class="flex justify-end gap-3 mt-6">
              <%= button_tag "作成完了",
                type: :submit,
                name: "commit_action",
                value: "mark_as_cooked",
                class: "action-primary btn-pop"
              %>

              <%= button_tag "リストから削除",
                    type: :submit,
                    name: "commit_action",
                    value: "remove_from_plan",
                    class: "btn btn-outline btn-error" %>
            </div>

        </div>
      </div>
      <% end %>
    </div>

  <% end %>

  <!-- ▼ おすすめメニュー -->
  <div class="max-w-md mx-auto mt-10 home-section home-delay-2">

    <% if @recommended_menus.present? %>

    <!-- 見出し＋更新 -->
    <div class="relative mb-6">

    <!-- 右上の更新ボタン -->
      <%= link_to root_path,
          class: "refresh-btn absolute right-0 top-1/2 -translate-y-1/2 z-10 inline-block
                  transition hover:scale-110 active:scale-95" do %>
        <%= image_tag "refresh.png", class: "w-14 h-10" %>
      <% end %>

      <!-- 中央タイトル -->
      <div class="recommended-title">
        <p>RECOMMENDED MENU</p>
      </div>
    </div>
  </div>

    <!-- メニュー一覧 -->
    <div class="space-y-3 home-child child-1">
      <% @recommended_menus.each do |menu| %>

        <div class="rounded-full shadow-sm mx-auto border-10 home-child child-2"
             style="background-color:#fffaf0; border-color:<%= genre_card_border_color(menu) %>; width: 300px;">

          <div class="flex items-center py-2 px-3">

            <span class="flex-1 text-center text-base font-semibold">
              <%= menu.title %>
            </span>

            <%= button_to "＋",
                  add_meal_item_my_menu_path(menu),
                  method: :post,
                  class: "btn btn-sm btn-circle ml-3 shadow-none
                          transition duration-200
                          hover:opacity-70 hover:-translate-y-[1px]
                          active:scale-95",
                  style: "background-color:#ad9d8a; border:none; color:white;" %>

          </div>
        </div>

      <% end %>
    </div>

  <% end %>
</div>


  <!-- ▼ メニューリンク -->
  <div class="flex justify-center gap-8 mt-10 relative home-section home-delay-3">
    
    <div class="home-child child-1">
      <%= link_to my_menus_path,
        class: "round-action-card w-40 h-40 sm:w-44 sm:h-44 flex flex-col items-center justify-center gap-2" do %>

        <%= image_tag "my_menu.png", class: "w-20 h-20 object-contain" %>

        <span class="text-sm font-semibold tracking-wide">
          マイメニュー
        </span>

      <% end %>
    </div>


    <div class="home-child child-2">
      <%= link_to new_meal_plan_path,
        class: "round-action-card w-40 h-40 sm:w-44 sm:h-44 flex flex-col items-center justify-center gap-2" do %>

        <%= image_tag "meal_plan.png", class: "w-20 h-20 object-contain" %>

        <span class="text-sm font-semibold tracking-wide">
          献立をつくる
        </span>

      <% end %>
    </div>
  </div>
</div>
