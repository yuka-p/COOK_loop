<% content_for :title, "マイメニュー一覧" %>
<div class="max-w-3xl mx-auto mt-8">

<!-- フィルターエリア -->
<div class="card bg-base-100 shadow px-8 py-4 max-w-2xl mx-auto page-section page-delay-1">

  <%= form_with url: my_menus_path, method: :get, local: true, id: "filterForm" do |f| %>

    <!-- ジャンル（hiddenで送信） -->
    <%= hidden_field_tag :genre, params[:genre] || "all", id: "genreInput" %>
    <%= hidden_field_tag :tag_ids, params[:tag_ids], id: "tagIdsInput" %>

    <!-- 中央寄せ用ラッパー -->
    <div class="max-w-4xl mx-auto space-y-4">

      <!-- 1段目：ジャンル + 並び替え -->
      <div class="flex flex-col md:flex-row md:items-center gap-4">

        <!-- 左：ジャンルボタン -->
        <div class="flex-1">
          <div id="genreFilters" class="flex gap-2 flex-wrap">
            <button
              class="btn btn-sm genre-filter-button
                     bg-[#bebbf7]/40
                     text-gray-700
                     border border-[#bebbf7]
                     hover:bg-[#bebbf7]/60"
              data-genre="all"
              type="button">
              すべて
            </button>

            <% MyMenu.genres.keys.each do |genre| %>
              <button
                class="btn btn-sm genre-filter-button <%= genre_button_class(genre) %>"
                data-genre="<%= genre %>"
                type="button">
                <%= MyMenu.genres_i18n[genre] %>
                <span
                  id="count-<%= genre %>"
                  class="ml-1 hidden text-xs font-bold bg-primary text-white rounded-full px-1.5">
                </span>
              </button>
            <% end %>
          </div>
        </div>

        <!-- 右：並び替え（幅固定で中央寄りに） -->
        <div class="w-full md:w-56">
          <%= f.select :sort,
            options_for_select(
              [
                ["新しい順", "created_desc"],
                ["最近作っていない順", "last_cooked_desc"],
                ["50音順", "title_asc"],
              ],
              params[:sort]
            ),
            {},
            class: "select select-bordered w-full",
            id: "sortSelect"
          %>
        </div>
      </div>

      <!-- 2段目：タグ（ジャンルの下・左寄せ） -->
      <% if @tags.present? %>
        <div id="tagFilters" class="flex gap-2 flex-wrap">
          <% @tags.each do |tag| %>
            <button
              type="button"
              class="tag-filter-button"
              data-tag-id="<%= tag.id %>">
              <%= tag.name %>
            </button>
          <% end %>
        </div>
      <% end %>

    </div>
  <% end %>
</div>

  <!-- 一覧 -->
<div class="bg-[#faf0e6] p-4 sm:p-8 rounded-2xl my-6 space-y-4 sm:space-y-6 page-section page-delay-2">

  <div class="flex flex-row gap-3 justify-center flex-wrap">
    <%= link_to "＋ 新規作成", new_my_menu_path,
          class: "action-primary" %>
    <%= link_to "定番メニューから選ぶ",
          master_menus_path(select: true),
          class: "btn btn-outline" %>
  </div>

  <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 page-section page-delay-3">

  <% @my_menus.each do |menu| %>
    <div class="relative bg-base-100 border-6 rounded-xl
                px-3 py-2
                transition
                hover:shadow-md
                hover:-translate-y-[1px]
                active:scale-[0.98]
                <%= genre_border_class(menu) %>">

      <%= link_to my_menu_path(menu), class: "block" do %>
        <div class="flex items-center gap-3">
          <p class="text-sm sm:text-base font-medium truncate flex-1">
            <%= menu.title %>
          </p>

          <!-- 編集ボタン -->
          <div class="shrink-0">
            <%= link_to "✎", edit_my_menu_path(menu),
                  class: "btn btn-ghost btn-xs hover:bg-base-200 transition",
                  data: { turbo: false } %>
          </div>
        </div>
      <% end %>

    </div>
  <% end %>
</div>

</div>

<div class="flex justify-center page-section page-delay-4">
  <%= link_to home_path, class: "nav-back-button" do %>
    ← ホーム
  <% end %>
</div>
